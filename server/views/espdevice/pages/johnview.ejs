<!--Author: W3layouts
Author URL: http://w3layouts.com
License: Creative Commons Attribution 3.0 Unported
License URL: http://creativecommons.org/licenses/by/3.0/
-->
<!DOCTYPE HTML>
<html>
<head>
<title>Lokesh control device</title>
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<!-- Custom Theme files -->
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/datepicker3.css" rel="stylesheet">
<link href="css/styles.css" rel="stylesheet">
<link href="css/logostyle.css" rel="stylesheet">

<!--Google Fonts-->
<link href='//fonts.googleapis.com/css?family=Roboto:400,500,700' rel='stylesheet' type='text/css'>
<link href='//fonts.googleapis.com/css?family=Ubuntu+Condensed' rel='stylesheet' type='text/css'>
<!--google fonts-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.0/jquery.js"></script>
<script src="js/bootstrap.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
    <!--header-top start here-->
    <div class="top-header">   
        <div class="row">
            <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
                <div class="container-fluid">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#sidebar-collapse">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>                                                                                               
                        <a class="navbar-brand" href="#"><span>L</span>okesh</a>     
                        <a class="navbar-brand connection off" href="#"></a>                   
                        <ul class="user-menu">
                            <li class="dropdown pull-right">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-user"></span> User <span class="caret"></span></a>
                                <ul class="dropdown-menu" role="menu">
                                    <li><a href="#"><span class="glyphicon glyphicon-user"></span> Profile</a></li>
                                    <li><a href="#"><span class="glyphicon glyphicon-cog"></span> Settings</a></li>
                                    <li><a href="#"><span class="glyphicon glyphicon-log-out"></span> Logout</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                                    
                </div><!-- /.container-fluid -->
            </nav> 
        </div>           
    </div>
    <!--header-top end here-->

    <section>

    <div class="container-fluid">
            <div class="row">
                <div class="col-md-12">
                    <ol class="breadcrumb">
                        <li><a href="#"><span class="glyphicon glyphicon-home"></span></a></li>
                        <!-- <li><a href="#"><span class="glyphicon connection off"></span></a></li> -->
                        <li class="active">Dashboard</li>
                    </ol>
                </div>
            </div><!--/.row-->
            <div class="row">
                <div class="col-lg-3 col-xs-6">
                    <div class="panel panel-white">
                        <div class="panel-heading panel-blue"><span class="glyphicon  glyphicon-king"></span>KHÁCH ROOM</div>
                        <div class="panel-body">
                            <div class="col-lg-6 col-xs-6">
                                <em  id="lamp1" class="light off"></em>
                            </div>   
                            <div class="col-lg-6 col-xs-6">                                                                   
                                <em class="glyphicon  glyphicon-king glyphicon-l"></em>                                                                    
                            </div>                                                            
                            <div class="col-lg-12 col-xs-12 action-buttons btn-group">                                
                                <div class="btn-group" id="status1" data-toggle="buttons">
                                    <label class="btn btn-default btn-off btn-lg active" onclick="changestatusrelay('1','1')">
                                    <input type="radio" value="0" name="multifeatured_module[module_id][status1]">TẮT ĐÈN</label>
                                    <label class="btn btn-default btn-on btn-lg" onclick="changestatusrelay('1','0')">
                                    <input type="radio" value="1" name="multifeatured_module[module_id][status1]" checked="checked">BẬT ĐÈN</label>                                            
                                </div>                                
                            </div>
                        </div>
                        <div class="panel-footer">                                                  
                        </div>
                    </div>                                                  
                </div><!-- ./col -->   

                <div class="col-lg-3 col-xs-6">
                    <div class="panel panel-white">
                        <div class="panel-heading panel-blue"><span class="glyphicon glyphicon-cutlery"></span>BẾP ROOM</div>
                        <div class="panel-body">
                            <div class="col-xs-6">
                                <em  id="lamp2" class="light off"></em>
                            </div>   
                            <div class="col-xs-6">                                                                   
                                <em class="glyphicon  glyphicon-cutlery glyphicon-l"></em>                                                                    
                            </div>                                                            
                            <div class="col-xs-12 action-buttons btn-group">
                                <div class="btn-group" id="status2" data-toggle="buttons">
                                    <label class="btn btn-default btn-off btn-lg active" onclick="changestatusrelay('2','1')">
                                    <input type="radio" value="0" name="multifeatured_module[module_id][status2]">TẮT ĐÈN</label>
                                    <label class="btn btn-default btn-on btn-lg" onclick="changestatusrelay('2','0')">
                                    <input type="radio" value="1" name="multifeatured_module[module_id][status2]" checked="checked">BẬT ĐÈN</label>                                             
                                </div>
                            </div>
                        </div>
                        <div class="panel-footer">                                                  
                        </div>
                    </div>                                                  
                </div><!-- ./col -->  
                
                <div class="col-lg-3 col-xs-6">
                    <div class="panel panel-white">
                        <div class="panel-heading panel-blue"><span class="glyphicon glyphicon-grain"></span>SÂN VƯỜN</div>
                        <div class="panel-body">
                            <div class="col-xs-6">
                                <em  id="lamp3" class="light off"></em>
                            </div>   
                            <div class="col-xs-6">                                                                   
                                <em class="glyphicon  glyphicon-grain glyphicon-l"></em>                                                                    
                            </div>                                                            
                            <div class="col-xs-12 action-buttons btn-group">
                                <div class="btn-group" id="status3" data-toggle="buttons">
                                    <label class="btn btn-default btn-off btn-lg active" onclick="changestatusrelay('3','1')">
                                    <input type="radio" value="0" name="multifeatured_module[module_id][status3]">TẮT ĐÈN</label>
                                    <label class="btn btn-default btn-on btn-lg" onclick="changestatusrelay('3','0')">
                                    <input type="radio" value="1" name="multifeatured_module[module_id][status3]" checked="checked">BẬT ĐÈN</label>                                              
                                </div>
                            </div>
                        </div>
                        <div class="panel-footer">                                                  
                        </div>
                    </div>                                                  
                </div><!-- ./col --> 

                <div class="col-lg-3 col-xs-6">
                    <div class="panel panel-white">
                        <div class="panel-heading panel-blue"><span class="glyphicon glyphicon-object-align-left"></span>CỔNG</div>
                        <div class="panel-body">
                            <div class="col-xs-6">
                                <em  id="lamp4" class="light off"></em>
                            </div>   
                            <div class="col-xs-6">                                                                   
                                <em class="glyphicon  glyphicon-object-align-left glyphicon-l"></em>                                                                    
                            </div>                                                            
                            <div class="col-xs-12 action-buttons btn-group">
                                <div class="btn-group" id="status4" data-toggle="buttons">
                                    <label class="btn btn-default btn-off btn-lg active" onclick="changestatusrelay('4','1')">
                                    <input type="radio" value="0" name="multifeatured_module[module_id][status4]">TẮT ĐÈN</label>
                                    <label class="btn btn-default btn-on btn-lg" onclick="changestatusrelay('4','0')">
                                    <input type="radio" value="1" name="multifeatured_module[module_id][status4]" checked="checked">BẬT ĐÈN</label>                                            
                                </div>
                            </div>
                        </div>
                        <div class="panel-footer">                                                  
                        </div>
                    </div>                                                  
                </div><!-- ./col --> 

            </div><!--/.row-->            
        </div>             
    </section>
   
    <footer id="footer" class="page-footer font-small blue pt-4 mt-4"><!--Footer-->
        <% include ../partials/footer.ejs %>
    </footer>    
</body>
<script type="text/javascript">
    
    function light_on(){
        $('.light').removeClass('off');
        $('.light').addClass('on');
    }
    function lamp1_on(){
        $('#lamp1.light').removeClass('off');
        $('#lamp1.light').addClass('on');
    }
    function lamp2_on(){
        $('#lamp2.light').removeClass('off');
        $('#lamp2.light').addClass('on');
    }
    function lamp3_on(){
        $('#lamp3.light').removeClass('off');
        $('#lamp3.light').addClass('on');
    }

    function light_off(){
        $('.light').removeClass('on');
        $('.light').addClass('off');
    }
    function lamp1_off(){
        $('#lamp1.light').removeClass('on');
        $('#lamp1.light').addClass('off');
    }
    function lamp2_off(){
        $('#lamp2.light').removeClass('on');
        $('#lamp2.light').addClass('off');
    }
    function lamp3_off(){
        $('#lamp3.light').removeClass('on');
        $('#lamp3.light').addClass('off');
    }

    function connection_on(){
        $('.connection').removeClass('off');
        $('.connection').addClass('on');
    }

    function connection_off(){
        $('.connection').removeClass('off');
        $('.connection').addClass('off');
    }
    // var socket = io.connect('https://protected-everglades-87452.herokuapp.com/');
    var connectSocketUrl = "<%process.env.CLOUDMQTT_URL%>";
    var socket = io.connect(connectSocketUrl || 'https://loinguyen-room-nhs.herokuapp.com/');
    socket.on('connect', function () {
        socket.on('mqtt', function (msg) {
            console.log(msg);
            console.log(connectSocketUrl);
            console.log(msg.type);
            if(msg.type == '9'){
                
                if(msg.type == '3' && msg.payload == '1'){
                    light_on();
                }
                else{
                    light_off();
                }
                connection_on();
            }

            if(msg.payload == '1'){
                switch (msg.type) {
                    case '1':
                        lamp1_on();
                        break;
                    case '2':
                        lamp2_on();
                        break;
                    case '3':
                        lamp3_on();
                        break;                          
                }
            }
            else{
                switch (msg.type) {
                    case '1':
                        lamp1_off();
                        break;
                    case '2':
                        lamp2_off();
                        break;
                    case '3':
                        lamp3_off();
                        break;                          
                }
            }                    
                
        });

        socket.emit('subscribe',{topic:'/sensor/OTGW/returntemp'});
    });

    function changestatusrelay(pinno, value){
            var url = '/on';
        if(value == '1'){
            url = '/off';
        }
        var data = {};
        data.pinno = pinno;
        data.value = value;
        postdata(url,data);
    }
    
    function checkstatus(){
        var url = '/status';
        getdata(url,{});
    }

    function postdata(url, data){
        console.log('URL'+url);
            $.ajax({
            type: 'POST',
            dataType: "json",
            data: JSON.stringify(data),
            contentType: "application/json",
            cache: false,
            url: url,						
            success: function(data) {
                console.log('success');
                console.log(JSON.stringify(data));
            }
        });
    }

    function getdata(url, data){
            $.ajax({
            type: 'GET',
            dataType: "json",
            data: data,
            contentType: "application/json",
            cache: false,
            url: url,						
            success: function(data) {
                console.log('success');
                console.log(JSON.stringify(data));
            }
        });
    }

    function checksubmitsetting(){
        var ontime = $('#ontime').val();
        var offtime = $('#offtime').val();
        var typeofftime = $('#typeofftime').val();
        var relaynumber = $('#relaynumber').val();
        
        if(!ontime || !offtime || !relaynumber){
            alert('Please input all fields');
        }
        else{
            $('#frmsubmit').submit();
        }
    }

    $(document).ready(function () {
        
        var typeofftime = "<%=setting.typeofftime %>";
        $('#typeofftime').val(typeofftime);

        var delayInMilliseconds = 1000; //1 second
        setTimeout(function() {
            checkstatus();
        }, delayInMilliseconds);
        
    });
</script>  
</html>

      	 
